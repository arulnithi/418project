//Function foo parsed from ast_test.py

#include <stdio.h>
#include <math.h>
#include <stdlib.h>

#define pi 3.14159265

__global__ voidvoid foo(float* arg,float* ret) {
    if (threadIdx.x > 20) {
        return;
    }
    float index=0;
    if (arg[index]>10) {
        ret[index]=1;
    }
    else {
        ret[index]=0;
    }
}

int main() {
    printf("STARTING MAIN FUNCTION\n");
    
    //Define constants to use
    const int N = 20;
    const int blocksize = 128;
    
    //Allocate the variables
    float arg [20]={1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20};
    float* ret=(float*)malloc(20*sizeof(float));
    
    //Declare and allocate the variables and copy it over to device
    float *argCuda;
    const int csize = N*sizeof(float);
    cudaMalloc( (void**)&argCuda, csize );
    
    //Setup variables for cuda block and grid and then call function
    dim3 dimBlock( blocksize, 1 );
    dim3 dimGrid( ((N + blocksize - 1) / blocksize), 1 );
    foo<<<dimGrid, dimBlock>>>(argCuda,ret);
    
    //Copy back result data
    cudaMemcpy(index, indexCuda, N * sizeof(float), cudaMemcpyDeviceToHost);
    
    //Free allocated memory
    cudaFree( argCuda );
    free (ret);
    return 0;
}
